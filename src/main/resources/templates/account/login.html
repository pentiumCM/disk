<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Login Page - 云盘系统</title>

	<meta name="description" content="User login page" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

	<!-- bootstrap & fontawesome -->
	<link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
	<link rel="stylesheet" href="/assets/font-awesome/4.5.0/css/font-awesome.min.css" />

	<!-- text fonts -->
	<link rel="stylesheet" href="/assets/css/fonts.googleapis.com.css" />

	<!-- ace styles -->
	<link rel="stylesheet" href="/assets/css/ace.min.css" />

	<!--[if lte IE 9]>
	<link rel="stylesheet" href="/assets/css/ace-part2.min.css" />
	<![endif]-->
	<link rel="stylesheet" href="/assets/css/ace-rtl.min.css" />

	<!--[if lte IE 9]>
	<link rel="stylesheet" href="assets/css/ace-ie.min.css" />
	<![endif]-->

	<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

	<!--[if lte IE 8]>
	<script src="/assets/js/html5shiv.min.js"></script>
	<script src="/assets/js/respond.min.js"></script>
	<![endif]-->
</head>

<body class="login-layout light-login">
<div class="main-container">
	<div class="main-content">
		<div class="row">
			<div class="col-sm-10 col-sm-offset-1">
				<div class="login-container">
					<div class="center">
						<h1>
							<span class="red">网盘存储(进行修改提交测试)</span>
							<span class="blue" id="id-text2">系统</span>
						</h1>
						<h4 class="blue" id="id-company-text">&copy; 基于JavaWeb的网盘存储系统</h4>
					</div>
					<div class="space-6"></div>
					<div class="position-relative">
						<div id="login-box" class="login-box visible widget-box no-border">
							<div class="widget-body">
								<div class="widget-main">
									<h4 class="header blue lighter bigger">
										<i class="ace-icon fa fa-coffee green"></i>
										请输入您的信息
									</h4>

									<div class="space-6"></div>

									<form id="login-form">
										<fieldset>
											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" placeholder="账号"  name="loginName"/>
															<i class="ace-icon fa fa-user"></i>
														</span>
											</label>

											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" placeholder="密码"  name="pwd"/>
															<i class="ace-icon fa fa-lock"></i>
														</span>
											</label>
											<div class="space"></div>
											<div class="clearfix">
												<label class="inline">
													<input type="checkbox" class="ace"  name="rememberMe"/>
													<span class="lbl"> 记住我</span>
												</label>
												<button type="button" class="width-35 pull-right btn btn-sm btn-primary" id="btn-login">
													<i class="ace-icon fa fa-key"></i>
													<span class="bigger-110">登录</span>
												</button>
											</div>

											<div class="space-4"></div>
										</fieldset>
									</form>
									<div class="space-6"></div>
								</div><!-- /.widget-main -->

								<div class="toolbar clearfix">

									<div>
										<a href="#" data-target="#signup-box" class="user-signup-link">
										去注册
											<i class="ace-icon fa fa-arrow-right"></i>
										</a>
									</div>
								</div>
							</div><!-- /.widget-body -->
						</div><!-- /.login-box -->

						<div id="forgot-box" class="forgot-box widget-box no-border">
							<div class="widget-body">
								<div class="widget-main">
									<h4 class="header red lighter bigger">
										<i class="ace-icon fa fa-key"></i>
										Retrieve Password
									</h4>

									<div class="space-6"></div>
									<p>
										Enter your email and to receive instructions
									</p>

									<form>
										<fieldset>
											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="email" class="form-control" placeholder="Email" />
															<i class="ace-icon fa fa-envelope"></i>
														</span>
											</label>

											<div class="clearfix">
												<button type="button" class="width-35 pull-right btn btn-sm btn-danger">
													<i class="ace-icon fa fa-lightbulb-o"></i>
													<span class="bigger-110">Send Me!</span>
												</button>
											</div>
										</fieldset>
									</form>
								</div><!-- /.widget-main -->

								<div class="toolbar center">
									<a href="#" data-target="#login-box" class="back-to-login-link">
										Back to login
										<i class="ace-icon fa fa-arrow-right"></i>
									</a>
								</div>
							</div><!-- /.widget-body -->
						</div><!-- /.forgot-box -->

						<div id="signup-box" class="signup-box widget-box no-border">
							<div class="widget-body">
								<div class="widget-main">
									<h4 class="header green lighter bigger">
										<i class="ace-icon fa fa-users blue"></i>
										新用户注册
									</h4>

									<div class="space-6"></div>
									<p> 输入您的详细信息以开始 </p>

									<form id="register-form">
										<fieldset>
											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" name="loginName" class="form-control" placeholder="账号：登录使用、唯一" />
															<i class="ace-icon fa fa-user-plus"></i>
														</span>
											</label>
											<label class="block">
													<div class="radio">
														<label>
															<input name="sex" type="radio" class="ace" value="1" checked/>
															<span class="lbl"> 男</span>
														</label>
														<label>
															<input name="sex" type="radio" class="ace"  value="2" />
															<span class="lbl"> 女</span>
														</label>
													</div>
											</label>
											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" name="nickName" class="form-control" placeholder="昵称" />
															<i class="ace-icon fa fa-user"></i>
														</span>
											</label>

											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" name="pwd" class="form-control" placeholder="密码" />
															<i class="ace-icon fa fa-lock"></i>
														</span>
											</label>

											<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" name="pwdrepeat" class="form-control" placeholder="重复密码" />
															<i class="ace-icon fa fa-retweet"></i>
														</span>
											</label>
											<div class="space-24"></div>

											<div class="clearfix">
												<button type="reset" class="width-30 pull-left btn btn-sm">
													<i class="ace-icon fa fa-refresh"></i>
													<span class="bigger-110">重置</span>
												</button>

												<button type="button" class="width-65 pull-right btn btn-sm btn-success" id="btn-register">
													<span class="bigger-110">注册</span>

													<i class="ace-icon fa fa-arrow-right icon-on-right"></i>
												</button>
											</div>
										</fieldset>
									</form>
								</div>

								<div class="toolbar center">
									<a href="#" data-target="#login-box" class="back-to-login-link">
										<i class="ace-icon fa fa-arrow-left"></i>
										返回登录
									</a>
								</div>
							</div><!-- /.widget-body -->
						</div><!-- /.signup-box -->
					</div><!-- /.position-relative -->
				</div>
			</div><!-- /.col -->
		</div><!-- /.row -->
	</div><!-- /.main-content -->
</div><!-- /.main-container -->
<script src="/assets/js/jquery-2.1.4.min.js"></script>
<script src="/assets/js/jquery.validate.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/bootbox.js"></script>
<script src="/js/base.js"></script>
<script type="text/javascript">
    $(function($) {
        $(document).on('click', '.toolbar a[data-target]', function(e) {
            e.preventDefault();
            var target = $(this).data('target');
            $('.widget-box.visible').removeClass('visible');//hide others
            $(target).addClass('visible');//show target
        });
    });

    function dologin() {
        var accountId = $("#login-form input[name=loginName]").val();
        var accountPwd = $("#login-form input[name=pwd]").val();
        $.ajax({
            type : "POST",
            url : "/account/login.do",
            data : JSON.stringify({
                loginName : accountId,
                pwd:accountPwd
            }),
            dataType: "json",
            success : function(result) {
                if (result.success==true) {
                    window.location.href = "/home/index";
                } else  {
                    bootbox.alert({
                        size: "small",
                        title: "提示",
                        message: result.errMsg,
                        callback: function(){ /* your callback code */ }
                    })
                }
            }
        });
    }

      function doRegister() {
        var formObj = $("#register-form").serializeObject();
        if(formObj.pwd!=formObj.pwdrepeat){
            bootbox.alert({
                size: "small",
                title: "提示",
                message: '密码与重复密码不一致',
                callback: function(){ /* your callback code */ }
            })
            return;
		}
        $.ajax({
            type : "POST",
            url : "/account/register",
            data : JSON.stringify(formObj),
            success : function(result) {
                if (result.success==true) {
                    bootbox.alert({
                        size: "small",
                        title: "提示",
                        message: '注册成功！',
                        callback: function(){
                            $('#register-form')[0].reset();
                            $('.back-to-login-link').click()
							$('#login-form input[name=loginName]').val(formObj.loginName)
                        }
                    })
                } else  {
                    bootbox.alert({
                        size: "small",
                        title: "提示",
                        message: result.errMsg,
                        callback: function(){ /* your callback code */ }
                    })
                }
            }
        });
    }

    $(function($) {
        $('#login-form').jqvalidate({
            rules: {
                loginName: {
                    required: true
                },
                pwd: {
                    required: true,
                }
            },
            messages: {
                loginName: {
                    required: "请输入账号",
                },
                pwd: {
                    required: "请输入密码",
                }
            }
        });

        $('#register-form').jqvalidate({
            rules: {
                loginName: {
                    required: true
                },
                pwd: {
                    required: true,
                },
                sex: {
                    required: true,
                },
                pwd: {
                    required: true,
                },
                pwdrepeat: {
                    required: true,
                },
            },
            messages: {
                loginName: {
                    required: "请输入账号",
                },
                pwd: {
                    required: "请输入密码",
                },
                pwdrepeat: {
                    required: "请输入重复密码",
                }
            }
		})

        $('#btn-login').on('click',function () {
            if(!$('#login-form').valid()){
                return;
			}
            dologin();
		});

        $('#btn-register').on('click',function (object) {
            if(!$('#register-form').valid()){
                return;
            }
            doRegister();
		})
    });
</script>
</body>
</html>
